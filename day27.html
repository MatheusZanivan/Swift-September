<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Performance & profiling (Instruments, leaks, rendering) | Swift September</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="./styles.css" />
    <meta name="description" content="Swift September – Day 27: Performance & profiling (Instruments, leaks, rendering)" />
  </head>
  <body class="day">
    <main class="page-grid">
      <aside class="left-rail">
        <div class="floating-cover" aria-hidden="true"></div>
      </aside>

      <div class="day-content">
        <nav class="breadcrumbs" aria-label="Breadcrumb">
        <ul><li>Day 27</li></ul>
      	</nav>

        <div class="day-hero">
          <h1>Performance & profiling (Instruments, leaks, rendering)</h1>
        </div>

        <div class="author-row">
          <img
            src="./images/profilePic.png"
            alt="Author"
            class="author-avatar"
            width="40"
            height="40"
            loading="lazy"
          />
          <div class="author-name">
            <strong>Matheus Z. Andrade</strong> | iOS Engineer
          </div>
          <div class="author-line" aria-hidden="true"></div>
        </div>

        <!-- 1) Introduction (mandatory, first) -->
        <section class="section">
          <h2 data-title="Introduction">Introduction</h2>
          <p>Performance is everything in mobile apps — users expect smooth, responsive experiences. On iOS, Instruments provides developers with powerful tools to understand how apps behave under the hood. Profiling CPU, memory, rendering, and energy usage helps us find bottlenecks and build apps that feel fluid and reliable.</p>
        </section>

        <!-- 2) Topic sections -->
        <section class="section">
          <h2 data-title="Time Profiler">Time Profiler</h2>
          <p>The Time Profiler instrument measures CPU usage and highlights which parts of your code consume the most time. This helps identify bottlenecks and optimize hot paths in your app.</p>
          <div class="codebox" role="region" aria-label="Swift example: measuring performance of sorting">
            <button class="codebox-copy" type="button" aria-label="Copy code">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path d="M9 9h7a2 2 0 0 1 2 2v7a2 2 0 0 1-2 2H9a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2Z" stroke="white" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M7 15H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h7a2 2 0 0 1 2 2v1" stroke="white" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
            <div class="codebox-toast">Copied</div>
            <pre><code>import Foundation

let numbers = (1...10_000).shuffled()

// Profile this block with Time Profiler
let sorted = numbers.sorted()
print(sorted.first ?? 0)</code></pre>
          </div>
        </section>

        <section class="section">
          <h2 data-title="Leaks & Allocations">Leaks & Allocations</h2>
          <p>Memory leaks can silently degrade performance and eventually crash apps. Instruments' Leaks and Allocations instruments track memory usage, revealing leaks or excessive allocations.</p>
          <div class="codebox" role="region" aria-label="Swift example: memory leak with closure capture">
            <button class="codebox-copy" type="button" aria-label="Copy code">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path d="M9 9h7a2 2 0 0 1 2 2v7a2 2 0 0 1-2 2H9a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2Z" stroke="white" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M7 15H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h7a2 2 0 0 1 2 2v1" stroke="white" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
            <div class="codebox-toast">Copied</div>
            <pre><code>class MyController {
    var onEvent: (() -> Void)?

    func setup() {
        // ❌ Retain cycle: closure captures self strongly
        onEvent = { print(self) }
    }
}</code></pre>
          </div>
          <p>Using <code>[weak self]</code> inside closures avoids leaks:</p>
          <div class="codebox" role="region" aria-label="Swift example: avoiding memory leak with weak self">
            <button class="codebox-copy" type="button" aria-label="Copy code">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path d="M9 9h7a2 2 0 0 1 2 2v7a2 2 0 0 1-2 2H9a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2Z" stroke="white" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M7 15H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h7a2 2 0 0 1 2 2v1" stroke="white" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
            <div class="codebox-toast">Copied</div>
            <pre><code>onEvent = { [weak self] in
    guard let self else { return }
    print(self)
}</code></pre>
          </div>
        </section>

        <section class="section">
          <h2 data-title="Core Animation">Core Animation</h2>
          <p>Animation and rendering performance directly affect how smooth your app feels. Instruments’ Core Animation template helps diagnose dropped frames and heavy UI updates.</p>
          <div class="codebox" role="region" aria-label="Swift example: optimizing animation with CALayer properties">
            <button class="codebox-copy" type="button" aria-label="Copy code">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path d="M9 9h7a2 2 0 0 1 2 2v7a2 2 0 0 1-2 2H9a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2Z" stroke="white" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M7 15H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h7a2 2 0 0 1 2 2v1" stroke="white" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
            <div class="codebox-toast">Copied</div>
            <pre><code>withAnimation(.easeInOut) {
    viewModel.isExpanded.toggle()
}</code></pre>
          </div>
          <p>Avoid forcing layout recalculations during animations (e.g., by minimizing calls to <code>layoutIfNeeded()</code> inside loops).</p>
        </section>

        <section class="section">
          <h2 data-title="Energy Log">Energy Log</h2>
          <p>Excessive background work or frequent timers can drain battery life. The Energy Log instrument reveals how CPU, GPU, and networking impact battery consumption.</p>
          <div class="codebox" role="region" aria-label="Swift example: using efficient background task with async/await">
            <button class="codebox-copy" type="button" aria-label="Copy code">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path d="M9 9h7a2 2 0 0 1 2 2v7a2 2 0 0 1-2 2H9a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2Z" stroke="white" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M7 15H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h7a2 2 0 0 1 2 2v1" stroke="white" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
            <div class="codebox-toast">Copied</div>
            <pre><code>func fetchData() async {
    do {
        let (data, _) = try await URLSession.shared.data(from: URL(string: "https://example.com")!)
        print("Fetched \(data.count) bytes")
    } catch {
        print("Error: \(error)")
    }
}</code></pre>
          </div>
        </section>

        <!-- 3) Conclusion (mandatory) -->
        <section class="section">
          <h2 data-title="Conclusion">Conclusion</h2>
          <p>Profiling with Instruments ensures apps are not just functional, but efficient and delightful to use. By paying attention to CPU, memory, rendering, and energy, we can ship apps that feel fast and scale well over time. Every optimization effort directly improves user satisfaction.</p>
        </section>

        <!-- 4) Next steps (mandatory, last) -->
        <section class="section" style="margin-bottom: 40px;">
          <h2 data-title="Next steps">Next steps</h2>
          <p>Try running your latest project in Instruments with the Time Profiler template. Look for methods that take longer than expected, and experiment with optimizing them. Next, check for leaks in closures and memory usage. Building this habit will keep your apps smooth and battery-friendly.</p>
          <ul>
            <li><a href="https://developer.apple.com/documentation/xcode/improving-your-app-s-performance" target="_blank" rel="noopener">Improving your app’s performance — Apple Docs</a></li>
            <li><a href="https://docs.swift.org/swift-book/LanguageGuide/Closures.html" target="_blank" rel="noopener">Closures  — The Swift Programming Language</a></li>
          </ul>
        </section>
      </div>

      <nav class="right-rail">
        <div class="floating-menu">
          <ul id="toc"></ul>
        </div>
      </nav>
    </main>

    <script src="./main.js" defer></script>
  </body>
</html>
